# Shapiro-Wilk 检验计算原理
Shapiro-Wilk 检验是统计学中最常用、最可靠的正态性检验方法之一。它专门用于检验一个给定的样本数据是否可能来自一个服从正态分布的总体。这是使用参数检验（如 t检验、方差分析 ANOVA、Pearson 相关等）前需要验证的关键前提条件之一。

### 核心要点

#### 核心目的：检验正态性假设
- 直接回答："样本数据是否显著偏离正态分布？"
- 对决定能否使用依赖正态分布的参数检验至关重要

#### 原假设 (H₀) 与备择假设 (H₁)
- **H₀ (零假设)**：样本数据来自正态分布的总体  
- **H₁ (备择假设)**：样本数据不是来自正态分布的总体（数据显著偏离正态）

#### 检验统计量 (W)
- W 值范围：0 到 1 之间  
- **W ≈ 1**：表明样本数据越可能服从正态分布  
- **W → 0**：表明数据偏离正态分布程度越大  
- 计算原理：基于样本数据与标准正态分布期望顺序统计量之间的相关性

#### p 值 (p-value)
- **p > α (通常 α=0.05)**：无法拒绝 H₀  
   ➠ 无足够证据表明数据显著偏离正态（注意：≠"证明"数据正态）  
- **p ≤ α (通常 α=0.05)**：拒绝 H₀  
  ➠ 有足够证据表明数据显著偏离正态分布

### 教会你的关键经验
1. **验证参数检验的基石**  
   明确判断 t检验/ANOVA 等方法的正态性前提是否成立  
   
2. **小样本检测利器**  
   在样本量 n < 50 时，比 Kolmogorov-Smirnov 检验功效更高  
   
3. **"无法拒绝" ≠ "接受"**  
   p > 0.05 不证明数据完美正态，仅表示当前样本未检测到显著非正态性  
   ➠ 必须结合图形（直方图、Q-Q图）判断  
   
4. **大样本敏感性**  
   当 n > 5000 时：  
   - 会检测出微小/实际无关的偏离（几乎总是 p < 0.05）  
   - 应更关注效应大小和图形检查，而非单纯依赖 p 值  
   
5. **决策依据**  
   | 结果                    | 建议                                                                     |
   |-------------------------|--------------------------------------------------------------------------|
   | p > 0.05 + 图形大致正常 | 可较放心使用参数检验（仍需检查方差齐性等前提）                             |
   | p ≤ 0.05                | 1. 尝试数据转换（对数/平方根）<br>2. 改用非参数检验<br>3. 评估偏离程度（结合图形） |

6. **不是万能的**  
   主要检测一般非正态性（偏态、峰度），对特定异常值/多峰分布敏感但非专门设计







### 公式符号说明
| 符号 | 含义 |
|------|------|
| $x_{(i)}$ | 数据排序后第 $i$ 个观测值（从小到大排序） |
| $a_i$ | 常数（由标准正态分布期望值生成，依赖样本量 $n$） |
| $\bar{x}$ | 样本均值 |
| $n$ | 样本大小 |

## 计算步骤（以论文中小鼠的躲藏时间为例）

1. **数据排序**  
   将原始观测值 $x_1, x_2, \dots, x_n$ 升序排列：
   $$x_{(1)} \leq x_{(2)} \leq \dots \leq x_{(n)}$$

2. **计算样本均值**
   $$\bar{x} = \frac{1}{n} \sum_{i=1}^{n} x_i$$

3. **计算分母**
   $$\text{分母} = \sum_{i=1}^{n} (x_i - \bar{x})^2$$
   （即样本方差的分子项）

4. **计算分子**
   - 查表获取 Shapiro-Wilk 系数 $a_i$（系数取决于样本量 $n$）
   - 计算加权和：
     $$b = \sum_{i=1}^{k} a_i (x_{(n-i+1)} - x_{(i)})$$
     其中 $k = \lfloor n/2 \rfloor$（$n/2$ 向下取整）
   - 分子项：
     $$\text{分子} = b^2$$

5. **计算统计量 W**
  
   $$w = \frac{b^2}{\sum_{a=1}^{n} (x_a - \bar{x})^2}$$

## 结果解读

### W 值特性
- $W \in [0, 1]$
- $W$ 值越接近 1，表明数据越符合正态分布
- $W$ 值越接近 0，表明数据偏离正态分布程度越大

### 统计推断
1. 根据计算的 $W$ 值和样本量 $n$ 查 Shapiro-Wilk 分布表
2. 获得对应的 $p$ 值
3. 判断标准：
   - $p \geq 0.05$ → 不能拒绝 H₀（数据符合正态分布）
   - $p < 0.05$ → 拒绝 H₀（数据显著偏离正态分布）

## 研究案例结论
- 该研究中多数行为参数（如躲藏时间）的检验结果：
  - $p < 0.05$
- 结论：拒绝正态性假设，表明这些行为参数数据显著偏离正态分布
